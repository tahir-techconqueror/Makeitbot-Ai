{
  "entities": {
    "Brand": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Brand",
      "type": "object",
      "description": "Represents a brand, containing settings for its public-facing menu and AI.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the brand."
        },
        "name": {
          "type": "string",
          "description": "The name of the brand."
        },
        "logoUrl": {
          "type": "string",
          "format": "uri",
          "description": "URL of the brand's logo."
        },
        "chatbotConfig": {
          "type": "object",
          "description": "Configuration for the AI chatbot.",
          "properties": {
            "basePrompt": {
              "type": "string",
              "description": "The base personality prompt for the AI budtender."
            },
            "welcomeMessage": {
              "type": "string",
              "description": "The initial welcome message shown in the chat window."
            }
          }
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a product available in the menu.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product."
        },
        "name": {
          "type": "string",
          "description": "Name of the product."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the product."
        },
        "price": {
          "type": "number",
          "description": "Price of the product."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the product image.",
          "format": "uri"
        },
        "categoryId": {
          "type": "string",
          "description": "Reference to Category. (Relationship: Category 1:N Product)"
        },
        "brandId": {
          "type": "string",
          "description": "Reference to Brand. (Relationship: Brand 1:N Product)"
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "price",
        "imageUrl",
        "categoryId",
        "brandId"
      ]
    },
    "Category": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Category",
      "type": "object",
      "description": "Represents a category of products.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the category."
        },
        "name": {
          "type": "string",
          "description": "Name of the category."
        },
        "description": {
          "type": "string",
          "description": "Description of the category."
        }
      },
      "required": [
        "id",
        "name",
        "description"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the markitbot AI Assistant.",
      "properties": {
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "displayName": {
          "type": "string",
          "description": "Display name of the user."
        },
        "favoriteLocationId": {
          "type": "string",
          "description": "The ID of the user's favorite dispensary location."
        },
        "role": {
          "type": "string",
          "description": "The user's role in the system.",
          "enum": [
            "customer",
            "brand",
            "dispensary",
            "owner"
          ]
        },
        "brandId": {
          "type": "string",
          "description": "For brand users, the ID of the brand they manage."
        },
        "locationId": {
          "type": "string",
          "description": "For dispensary users, the ID of the location they manage."
        }
      },
      "required": [
        "email"
      ]
    },
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents an order placed by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Order)"
        },
        "orderDate": {
          "type": "string",
          "description": "Date and time the order was placed.",
          "format": "date-time"
        },
        "totalAmount": {
          "type": "number",
          "description": "Total amount of the order."
        }
      },
      "required": [
        "id",
        "userId",
        "orderDate",
        "totalAmount"
      ]
    },
    "OrderItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OrderItem",
      "type": "object",
      "description": "Represents an item within an order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order item."
        },
        "orderId": {
          "type": "string",
          "description": "Reference to Order. (Relationship: Order 1:N OrderItem)"
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N OrderItem)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the product in the order item."
        },
        "price": {
          "type": "number",
          "description": "Price of the product in the order item."
        }
      },
      "required": [
        "id",
        "orderId",
        "productId",
        "quantity",
        "price"
      ]
    },
    "Content": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Content",
      "type": "object",
      "description": "Represents content created by the AI, such as blog posts or articles.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the content."
        },
        "title": {
          "type": "string",
          "description": "Title of the content."
        },
        "body": {
          "type": "string",
          "description": "The actual content (e.g., blog post text)."
        },
        "contentType": {
          "type": "string",
          "description": "Type of content (e.g., 'blog post', 'article')."
        },
        "creationDate": {
          "type": "string",
          "description": "Date and time the content was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "title",
        "body",
        "contentType",
        "creationDate"
      ]
    },
    "UserInteraction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserInteraction",
      "type": "object",
      "description": "Represents a user interaction with the AI assistant, useful for recommendations.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user interaction."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N UserInteraction)"
        },
        "interactionDate": {
          "type": "string",
          "description": "Date and time of the interaction.",
          "format": "date-time"
        },
        "query": {
          "type": "string",
          "description": "The user's query or input."
        },
        "recommendedProductIds": {
          "type": "array",
          "description": "References to Products recommended during this interaction. (Relationship: UserInteraction 1:N Product)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "userId",
        "interactionDate",
        "query"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/brands/{brandId}",
        "definition": {
          "entityName": "Brand",
          "schema": {
            "$ref": "#/backend/entities/Brand"
          },
          "description": "Stores brand-specific configuration and settings.",
          "params": [
            {
              "name": "brandId",
              "description": "The unique identifier of the brand."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. The {userId} is the Firebase Authentication UID.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Authentication UID of the user."
            }
          ]
        }
      },
      {
        "path": "/categories/{categoryId}",
        "definition": {
          "entityName": "Category",
          "schema": {
            "$ref": "#/backend/entities/Category"
          },
          "description": "Stores product categories.",
          "params": [
            {
              "name": "categoryId",
              "description": "The unique identifier of the category."
            }
          ]
        }
      },
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores product information.",
          "params": [
            {
              "name": "productId",
              "description": "The unique identifier of the product."
            }
          ]
        }
      },
      {
        "path": "/orders/{orderId}",
        "definition": {
          "entityName": "Order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "Stores order information. Accessible by customers who placed the order and dispensaries fulfilling it.",
          "params": [
            {
              "name": "orderId",
              "description": "The unique identifier of the order."
            }
          ]
        }
      },
      {
        "path": "/content/{contentId}",
        "definition": {
          "entityName": "Content",
          "schema": {
            "$ref": "#/backend/entities/Content"
          },
          "description": "Stores AI-generated content.",
          "params": [
            {
              "name": "contentId",
              "description": "The unique identifier of the content."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/interactions/{interactionId}",
        "definition": {
          "entityName": "UserInteraction",
          "schema": {
            "$ref": "#/backend/entities/UserInteraction"
          },
          "description": "Stores user interactions with the AI assistant, nested under the user. This supports personalized recommendations.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Authentication UID of the user who interacted with the AI assistant."
            },
            {
              "name": "interactionId",
              "description": "The unique identifier of the user interaction."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the markitbot AI Assistant, a WordPress plugin that provides AI-powered product recommendations, menu generation, content creation, and order management integration. The structure emphasizes authorization independence, clarity, and scalability, following the principles of DBAC (Database-Based Access Control). It avoids hierarchical authorization dependencies by denormalizing data where necessary, ensuring that security rules can be simple and efficient.\n\nThe key structural decisions and their justifications are:\n\n*   **Brands Collection (`/brands/{brandId}`):** Stores brand-specific settings, allowing for a multi-tenant architecture where each brand can have its own configuration for things like the AI chatbot.\n*   **Users Collection (`/users/{userId}`):** Stores user profiles with a `role` field to differentiate between customers, brands, and dispensaries.\n*   **Categories Collection (`/categories/{categoryId}`):** Stores product categories. No specific ownership required, so top-level collection.\n*   **Products Collection (`/products/{productId}`):** Stores product information and now includes a `brandId` to associate it with a brand.\n*   **Orders Collection (`/orders/{orderId}`):** A root collection for all orders. This is a crucial change. It prevents a dispensary from needing to `get()` a user document to access an order, which would violate security rules. Security rules will grant access based on the order's `userId` (for customers) and `locationId` (for dispensaries).\n*   **Content Collection (`/content/{contentId}`):** Stores AI-generated content. No specific ownership required, so top-level collection.\n*   **UserInteractions Collection (`/users/{userId}/interactions/{interactionId}`):** Stores user interactions with the AI assistant, nested under the user. This supports personalized recommendations and utilizes path-based ownership.\n\nThis structure achieves **Authorization Independence** by:\n\n*   Using a root `/orders` collection. This allows a dispensary user (who is not the customer) to query for and update orders belonging to their location without needing to read the customer's user profile.\n\nThe structure supports the required **QAPs (Rules are not Filters)** by:\n\n*   Segregating data with different access needs into separate collections.\n*   Utilizing path-based ownership for user-specific data (interactions)."
  }
}
